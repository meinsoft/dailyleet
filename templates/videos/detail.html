{% extends 'base.html' %}

{% block title %}{{ video.title }} - DailyLeet{% endblock %}

{% block meta_description %}{{ video.description|truncatewords:30 }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-b from-black to-deep-blue">
    <!-- Video Header -->
    <section class="pt-24 pb-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-8">
                <nav class="text-sm mb-4">
                    <ol class="flex items-center space-x-2 text-gray-400">
                        <li><a href="{% url 'core:home' %}" class="hover:text-white transition-colors">Home</a></li>
                        <li><i class="fas fa-chevron-right text-xs"></i></li>
                        <li><a href="{% url 'videos:list' %}" class="hover:text-white transition-colors">Videos</a></li>
                        <li><i class="fas fa-chevron-right text-xs"></i></li>
                        <li class="text-white truncate">{{ video.title }}</li>
                    </ol>
                </nav>
                
                <div class="flex items-center gap-4 mb-4">
                    <span class="px-3 py-1 text-sm font-semibold rounded-full
                               {% if video.difficulty == 'easy' %}bg-green-500 text-green-100
                               {% elif video.difficulty == 'medium' %}bg-yellow-500 text-yellow-100
                               {% else %}bg-red-500 text-red-100{% endif %}">
                        {{ video.get_difficulty_display }}
                    </span>
                    {% if video.leetcode_problem_number %}
                    <span class="px-3 py-1 text-sm font-medium bg-accent-blue text-white rounded-full">
                        Problem #{{ video.leetcode_problem_number }}
                    </span>
                    {% endif %}
                </div>
                
                <h1 class="text-4xl md:text-5xl font-bold text-gradient font-display mb-4">
                    {{ video.title }}
                </h1>
                
                <div class="flex items-center gap-6 text-gray-400 text-sm">
                    <span><i class="fas fa-calendar mr-2"></i>{{ video.created_at|date:"F d, Y" }}</span>
                    <span><i class="fas fa-eye mr-2"></i>{{ video.view_count }} views</span>
                    <span><i class="fas fa-code mr-2"></i>{{ video.code_language|title }}</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="pb-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <!-- Left Column: Video -->
                <div class="space-y-8">
                    <!-- YouTube Embed -->
                    <div class="glass-effect rounded-xl overflow-hidden">
                        <div class="relative" style="padding-bottom: 56.25%; height: 0;">
                            <iframe 
                                src="{{ video.get_embed_url }}"
                                class="absolute top-0 left-0 w-full h-full"
                                frameborder="0"
                                allowfullscreen
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                            </iframe>
                        </div>
                    </div>
                    
                    <!-- Video Description -->
                    <div class="glass-effect rounded-xl p-8">
                        <h2 class="text-2xl font-bold text-white mb-4">Description</h2>
                        <div class="prose prose-invert max-w-none">
                            <p class="text-gray-300 leading-relaxed whitespace-pre-line">{{ video.description }}</p>
                        </div>
                        
                        <!-- Tags -->
                        {% if video.tags.all %}
                        <div class="mt-6 pt-6 border-t border-gray-700">
                            <h3 class="text-lg font-semibold text-white mb-3">Tags</h3>
                            <div class="flex flex-wrap gap-2">
                                {% for tag in video.tags.all %}
                                <a href="{% url 'videos:tagged' tag.slug %}" 
                                   class="px-3 py-1 text-sm font-medium rounded-full bg-slate text-gray-300 hover:bg-accent-blue hover:text-white transition-all duration-300">
                                    {{ tag.name }}
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Right Column: Code -->
                <div class="space-y-8">
                    <!-- Code Block -->
                    <div class="glass-effect rounded-xl overflow-hidden">
                        <div class="bg-gray-900 px-6 py-4 border-b border-gray-700">
                            <div class="flex items-center justify-between">
                                <h2 class="text-xl font-bold text-white">Solution Code</h2>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm text-gray-400">{{ video.code_language|title }}</span>
                                    <button onclick="copyCode()" class="text-gray-400 hover:text-white transition-colors p-2 rounded">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="relative">
                            <pre class="overflow-x-auto p-6 text-sm leading-relaxed"><code class="language-{{ video.code_language }}" id="code-block">{{ video.code }}</code></pre>
                        </div>
                    </div>
                    
                    <!-- Related Videos -->
                    {% if related_videos %}
                    <div class="glass-effect rounded-xl p-8">
                        <h2 class="text-2xl font-bold text-white mb-6">Related Videos</h2>
                        <div class="space-y-4">
                            {% for related in related_videos %}
                            <a href="{{ related.get_absolute_url }}" class="flex items-center gap-4 p-4 rounded-lg bg-black bg-opacity-30 hover:bg-opacity-50 transition-all duration-300 group">
                                <img src="{{ related.thumbnail_url }}" alt="{{ related.title }}" 
                                     class="w-20 h-12 object-cover rounded flex-shrink-0">
                                <div class="min-w-0 flex-1">
                                    <h3 class="font-semibold text-white group-hover:text-accent-blue-light transition-colors truncate">
                                        {{ related.title }}
                                    </h3>
                                    <div class="flex items-center gap-3 text-xs text-gray-400 mt-1">
                                        <span class="px-2 py-0.5 rounded-full
                                                   {% if related.difficulty == 'easy' %}bg-green-500 text-green-100
                                                   {% elif related.difficulty == 'medium' %}bg-yellow-500 text-yellow-100
                                                   {% else %}bg-red-500 text-red-100{% endif %}">
                                            {{ related.get_difficulty_display }}
                                        </span>
                                        <span><i class="fas fa-eye mr-1"></i>{{ related.view_count }}</span>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Copy Success Toast -->
<div id="copy-toast" class="fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg transform translate-y-full transition-transform duration-300 z-50">
    <i class="fas fa-check mr-2"></i>Code copied to clipboard!
</div>
{% endblock %}

{% block extra_js %}
<script>
function copyCode() {
    const codeBlock = document.getElementById('code-block');
    const text = codeBlock.textContent;
    
    navigator.clipboard.writeText(text).then(function() {
        showCopyToast();
    }).catch(function(err) {
        console.error('Could not copy text: ', err);
    });
}

function showCopyToast() {
    const toast = document.getElementById('copy-toast');
    toast.classList.remove('translate-y-full');
    
    setTimeout(() => {
        toast.classList.add('translate-y-full');
    }, 2000);
}

// Initialize Prism.js when the page loads
document.addEventListener('DOMContentLoaded', function() {
    if (typeof Prism !== 'undefined') {
        Prism.highlightAll();
    }
});
</script>
{% endblock %}